<div class="category-page-container">
  <h1 class="category-title">{{ title }}</h1>

  <ng-container *ngIf="searchFilter">
    <h1 class="category-title">Rezultat pretrage: "{{ searchFilter }}"</h1>
  </ng-container>

  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <ng-container *ngIf="glavnaGrupa">
      <div [routerLink]="['/', glavnaGrupa]" class="breadcrumb-link">
        {{ utilService.formatirajNaziv(glavnaGrupa) }}
      </div>
    </ng-container>
    <ng-container *ngIf="nadgrupa">
      <span class="breadcrumb-separator">&gt;</span>
      <div [routerLink]="['/', glavnaGrupa, nadgrupa]" class="breadcrumb-link">
        {{ utilService.formatirajNaziv(nadgrupa) }}
      </div>
    </ng-container>
    <ng-container *ngIf="grupa">
      <span class="breadcrumb-separator">&gt;</span>
      <span class="breadcrumb-current">{{ utilService.formatirajNaziv(grupa) }}</span>
    </ng-container>
  </div>

  <!-- Podkategorije (nadgrupe) -->
  <div *ngIf="glavnaGrupa && !nadgrupa" class="sub-category-row">
    <div *ngFor="let subCategory of subCategories" class="sub-category-card">
      <div [routerLink]="['/', glavnaGrupa, subCategory.name]">
        <img
          [src]="subCategory.imgUrl"
          [alt]="subCategory.name"
          (error)="onImageError($event)"
        />
        <p>{{ subCategory.name }}</p>
      </div>
    </div>
  </div>

  <!-- Grupe unutar nadgrupe (bez slike) -->
  <div *ngIf="glavnaGrupa && nadgrupa && !grupa" class="sub-category-row">
    <div
      *ngFor="let group of groups"
      class="sub-category-card no-image group-card"
      [routerLink]="['/', glavnaGrupa, nadgrupa, group.name]"
    >
      <div class="no-image-box">
        <span>{{ group.name }}</span>
      </div>
    </div>
  </div>



  <!-- Dugme za otvaranje filtera - samo mobilni -->
  <button class="filter-toggle-btn" (click)="showMobileFilters = true">
    Filtriraj
  </button>

  <!-- Overlay i mobilni panel filtera -->
  <div
    class="filter-overlay"
    *ngIf="showMobileFilters"
    (click)="showMobileFilters = false"
  ></div>

  <div class="mobile-filter-panel" *ngIf="showMobileFilters">
    <button class="close-mobile-filters" (click)="showMobileFilters = false">
      ✖
    </button>

    <div class="filters-container">
      <!-- Cena -->
      <div class="slider-container">
        <label>Cena:</label>
        <div class="slider-values">
          <span>{{ minValue || 0 }} din.</span>
          <span>{{ maxValue || 0 }} din.</span>
        </div>

        <div class="slider">
          <input
            type="range"
            [min]="initialMinValue"
            [max]="initialMaxValue"
            [value]="minValue"
            (input)="minValue = +$event.target.value; updateSlider()"
          />
          <input
            type="range"
            [min]="initialMinValue"
            [max]="initialMaxValue"
            [value]="maxValue"
            (input)="maxValue = +$event.target.value; updateSlider()"
          />
        </div>
      </div>

      <!-- Filteri -->
      <div class="filter-category" *ngFor="let category of filterCategories">
        <h3>{{ category.category }}</h3>

        <div
          class="filter-item"
          *ngFor="let type of (isExpanded(category.category)
            ? category.types
            : category.types.slice(0, 10))"
        >
          <input
            type="checkbox"
            [checked]="selectedTypes[category.category]?.includes(type.name)"
            (change)="onTypeChange(category.category, type.name, $event.target.checked)"
            id="{{ category.category }}-{{ type.name }}"
          />
          <label [for]="category.category + '-' + type.name">
            {{ type.name }} <span>({{ type.quantity }})</span>
          </label>
        </div>

        <button
          *ngIf="category.types.length > 10"
          (click)="toggleCategory(category.category)"
          class="show-more-btn"
        >
          {{ isExpanded(category.category)
          ? 'Prikaži manje'
          : 'Prikaži više (' + (category.types.length - 10) + ')' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Glavni sadržaj -->
  <div class="main-content">
    <app-loading-overlay [isLoading]="isLoading"></app-loading-overlay>

    <!-- Sidebar (desktop filteri) -->
    <div class="sidebar">
      <div class="filters-container">
        <div class="slider-container">
          <label>Cena:</label>
          <div class="slider-values">
            <span>{{ minValue || 0 }} din.</span>
            <span>{{ maxValue || 0 }} din.</span>
          </div>

          <div class="slider">
            <input
              type="range"
              [min]="initialMinValue"
              [max]="initialMaxValue"
              [value]="minValue"
              (input)="minValue = +$event.target.value; updateSlider()"
            />
            <input
              type="range"
              [min]="initialMinValue"
              [max]="initialMaxValue"
              [value]="maxValue"
              (input)="maxValue = +$event.target.value; updateSlider()"
            />
          </div>
        </div>

        <div class="filter-category" *ngFor="let category of filterCategories">
          <h3>{{ category.category }}</h3>

          <div
            class="filter-item"
            *ngFor="let type of (isExpanded(category.category)
              ? category.types
              : category.types.slice(0, 10))"
          >
            <input
              type="checkbox"
              [checked]="selectedTypes[category.category]?.includes(type.name)"
              (change)="onTypeChange(category.category, type.name, $event.target.checked)"
              id="{{ category.category }}-{{ type.name }}"
            />
            <label [for]="category.category + '-' + type.name">
              {{ type.name }} <span>({{ type.quantity }})</span>
            </label>
          </div>

          <button
            *ngIf="category.types.length > 10"
            (click)="toggleCategory(category.category)"
            class="show-more-btn"
          >
            {{ isExpanded(category.category)
            ? 'Prikaži manje'
            : 'Prikaži više (' + (category.types.length - 10) + ')' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Proizvodi i paginacija -->
    <div class="page-container">
      <div class="products-grid">
        <app-productcard
          *ngFor="let product of products"
          [product]="product"
        ></app-productcard>
      </div>

      <div class="pagination-container">
        <button
          class="pagination-btn"
          (click)="goToPrevious()"
          [disabled]="currentPage === 0"
        >
          ‹
        </button>

        <ng-container *ngFor="let page of visiblePages">
          <button
            *ngIf="page !== '...'; else dots"
            class="pagination-btn"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
          >
            {{ page + 1 }}
          </button>
          <ng-template #dots>
            <span class="pagination-btn disabled dots">…</span>
          </ng-template>
        </ng-container>

        <button
          class="pagination-btn"
          (click)="goToNext()"
          [disabled]="currentPage === totalPages - 1"
        >
          ›
        </button>
      </div>
    </div>
  </div>
</div>
