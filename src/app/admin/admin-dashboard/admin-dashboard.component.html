<div class="admin-dashboard-page">
  <div class="admin-dashboard-container">
    <h1 class="admin-title">Admin portal – featured proizvodi</h1>

    <!-- TABOVI -->
    <div class="tabs">
      <button class="tab-btn" [class.active]="activeTab === 'add'" (click)="setTab('add')">
        Dodaj featured proizvod
      </button>

      <button class="tab-btn" [class.active]="activeTab === 'list'" (click)="setTab('list')">
        Pregled postojećih
      </button>
    </div>

    <div class="tab-content-card">

      <!-- ------------------------------------ -->
      <!-- ADD TAB -->
      <!-- ------------------------------------ -->
      <div *ngIf="activeTab === 'add'" class="tab-panel">
        <h2 class="section-title">Dodavanje novog featured proizvoda</h2>
        <p class="section-subtitle">Obeleži proizvod kao Top / Akcija / Novo / Preporučeno.</p>

        <div *ngIf="submitSuccess" class="alert alert-success">
          Proizvod je uspešno sačuvan.
        </div>

        <div *ngIf="submitError" class="alert alert-error">
          {{ submitError }}
        </div>

        <form class="featured-form" (ngSubmit)="submitNew()">

          <div class="form-row">
            <div class="form-field">
              <label>Feature tip</label>
              <select [(ngModel)]="newFeatured.featureType" name="featureType" required>
                <option *ngFor="let ft of featureTypes" [value]="ft.value">{{ ft.label }}</option>
              </select>
            </div>

            <div class="form-field">
              <label>Barcode</label>
              <input type="text" [(ngModel)]="newFeatured.barcode" name="barcode" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label>Prioritet</label>
              <select [(ngModel)]="newFeatured.priority" name="priority" required>
                <option *ngFor="let p of priorities" [value]="p">{{ p }}</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label>Važi od</label>
              <input type="datetime-local" [(ngModel)]="newFeatured.validFrom" name="validFrom" required />
            </div>

            <div class="form-field">
              <label>Važi do</label>
              <input type="datetime-local" [(ngModel)]="newFeatured.validTo" name="validTo" required />
            </div>
          </div>

          <div class="form-actions">
            <button class="primary-btn" type="submit" [disabled]="isSubmitting">
              <span *ngIf="!isSubmitting">Sačuvaj</span>
              <span *ngIf="isSubmitting">Čuvanje...</span>
            </button>
          </div>

        </form>
      </div>

      <!-- ------------------------------------ -->
      <!-- LIST TAB -->
      <!-- ------------------------------------ -->
      <div *ngIf="activeTab === 'list'" class="tab-panel">
        <h2 class="section-title">Pregled postojećih featured proizvoda</h2>
        <p class="section-subtitle">Lista svih TOP / Akcija / Novo / Preporučeno proizvoda.</p>

        <div *ngIf="!featuredProducts.length" class="empty-state">
          Još uvek nema featured proizvoda.
        </div>

        <!-- DESKTOP TABELA -->
        <table class="featured-table desktop-only" *ngIf="featuredProducts.length">
          <thead>
          <tr>
            <th>ID</th>
            <th>Proizvod</th>
            <th>Tip</th>
            <th>Prioritet</th>
            <th>Važi od</th>
            <th>Važi do</th>
            <th></th>
          </tr>
          </thead>

          <tbody>
          <tr *ngFor="let item of featuredProducts">
            <td>{{ item.featured.id }}</td>

            <td class="cell-product">
              <img class="product-img" [src]="getMainImage(item)" alt="slika" />
              <div class="product-info">
                <div class="p-name">{{ item.artikal?.naziv }}</div>
                <div class="p-barcode">#{{ item.featured.barcode }}</div>
                <div class="p-price">{{ item.artikal?.b2bcena }} RSD</div>
              </div>
            </td>

            <td>{{ item.featured.featureType }}</td>
            <td>{{ item.featured.priority }}</td>
            <td>{{ item.featured.validFrom | date:'dd.MM.yyyy HH:mm' }}</td>
            <td>{{ item.featured.validTo | date:'dd.MM.yyyy HH:mm' }}</td>

            <td class="cell-actions">
              <button class="delete-btn" (click)="deleteFeatured(item)">Obriši</button>
            </td>
          </tr>
          </tbody>
        </table>

        <!-- MOBILNA LISTA -->
        <div class="featured-mobile-list mobile-only" *ngIf="featuredProducts.length">
          <div class="featured-mobile-item" *ngFor="let item of featuredProducts">

            <div class="fm-header">
              <img [src]="getMainImage(item)" alt="slika" />
              <div>
                <div class="fm-title">{{ item.artikal?.naziv }}</div>
                <div class="fm-barcode">#{{ item.featured.barcode }}</div>
              </div>
            </div>

            <div class="fm-info-row">
              <div class="fm-type">{{ item.featured.featureType }}</div>
              <div class="fm-price">{{ item.artikal?.b2bcena }} RSD</div>
            </div>

            <div class="fm-info-row">
              <div>Od: {{ item.featured.validFrom | date:'dd.MM.yyyy HH:mm' }}</div>
              <div>Do: {{ item.featured.validTo | date:'dd.MM.yyyy HH:mm' }}</div>
            </div>

            <div class="fm-actions">
              <button class="delete-btn" (click)="deleteFeatured(item)">Obriši</button>
            </div>

          </div>
        </div>

      </div>

    </div>
  </div>
</div>
